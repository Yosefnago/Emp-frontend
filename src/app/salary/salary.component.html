<!-- salary.component.html -->
<div class="salary-container">
  <!-- Header -->
  <div class="salary-header">
    <button class="back-button" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      <span>×—×–×•×¨</span>
    </button>
    <div class="header-content">
      <h1 class="page-title">× ×™×”×•×œ ××©×›×•×¨×•×ª</h1>
      <p class="page-subtitle">×¡×˜×˜×™×¡×˜×™×§×•×ª ×•×“×•×—×•×ª ××©×›×•×¨×•×ª</p>
    </div>
  </div>

  <!-- Filters Section -->
  <section class="filters-section">
    <div class="filter-group">
      <div class="filter-item">
        <label class="filter-label">×©× ×”</label>
        <select [(ngModel)]="selectedYear" (change)="filterSalaries()" class="filter-select">
          @for (year of availableYears; track year) {
            <option [value]="year">{{ year }}</option>
          }
        </select>
      </div>

      <div class="filter-item">
        <label class="filter-label">×—×•×“×©</label>
        <select [(ngModel)]="selectedMonth" (change)="filterSalaries()" class="filter-select">
          <option value="">×›×œ ×”×—×•×“×©×™×</option>
          <option value="1">×™× ×•××¨</option>
          <option value="2">×¤×‘×¨×•××¨</option>
          <option value="3">××¨×¥</option>
          <option value="4">××¤×¨×™×œ</option>
          <option value="5">×××™</option>
          <option value="6">×™×•× ×™</option>
          <option value="7">×™×•×œ×™</option>
          <option value="8">××•×’×•×¡×˜</option>
          <option value="9">×¡×¤×˜××‘×¨</option>
          <option value="10">××•×§×˜×•×‘×¨</option>
          <option value="11">× ×•×‘××‘×¨</option>
          <option value="12">×“×¦××‘×¨</option>
        </select>
      </div>

      <button class="filter-reset-btn" (click)="clearFilters()">× ×§×” ×¡×™× ×•×Ÿ</button>
    </div>
  </section>

  <!-- Salary Statistics -->
  <section class="statistics-section">
    <h3 class="section-title">ğŸ“Š ×¡×˜×˜×™×¡×˜×™×§×•×ª ××©×›×•×¨×•×ª</h3>
    <div class="stats-grid">
      <div class="stat-card stat-card-blue">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">×¡×”"×› ××©×›×•×¨×•×ª</p>
          <p class="stat-value">â‚ª{{ formatNumber(getSalaryStats()?.totalSalaries) }}</p>
        </div>
      </div>

      <div class="stat-card stat-card-green">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">××©×›×•×¨×ª ×××•×¦×¢×ª</p>
          <p class="stat-value">â‚ª{{ formatNumber(getSalaryStats()?.averageSalary) }}</p>
        </div>
      </div>

      <div class="stat-card stat-card-orange">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"></path>
            <line x1="12" y1="6" x2="12" y2="12"></line>
            <line x1="12" y1="12" x2="16" y2="16"></line>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">×¢×•×‘×“×™× ×‘×ª×©×œ×•×</p>
          <p class="stat-value">{{ getSalaryStats()?.employeeCount }}</p>
        </div>
      </div>

      <div class="stat-card stat-card-purple">
        <div class="stat-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            <line x1="12" y1="2" x2="12" y2="22"></line>
          </svg>
        </div>
        <div class="stat-info">
          <p class="stat-label">××©×›×•×¨×ª ×’×‘×•×”×” ×‘×™×•×ª×¨</p>
          <p class="stat-value">â‚ª{{ formatNumber(getSalaryStats()?.maxSalary) }}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Salary Report Section -->
  <section class="report-section">
    <h3 class="section-title">ğŸ“„ ×“×•×— ××©×›×•×¨×•×ª ×œ×¢×•×‘×“×™×</h3>
    <div class="employees-grid">
      @if (filteredSalaries.length > 0) {
        @for (salary of filteredSalaries; track salary.id) {
          <div class="employee-salary-card" [class.expanded]="expandedEmployeeId === salary.id">
            <div class="card-header">
              <div class="employee-info">
                <h4 class="employee-name">{{ salary.employeeName }}</h4>
                <p class="employee-position">{{ salary.position }}</p>
              </div>
              <div class="salary-amount">â‚ª{{ formatNumber(salary.totalSalary) }}</div>
            </div>

            <div class="card-status">
              <span class="attendance-badge" [class]="'badge-' + (salary.attendanceComplete ? 'complete' : 'incomplete')">
                {{ salary.attendanceComplete ? 'âœ“ × ×•×›×—×•×ª ×ª×§×™× ×”' : 'âœ— × ×•×›×—×•×ª ×—×¡×¨×”' }}
              </span>
            </div>

            @if (salary.attendanceComplete) {
              <button class="generate-report-btn" (click)="toggleReport(salary.id)">
                {{ expandedEmployeeId === salary.id ? '×¡×’×•×¨ ×“×•×—' : '×¦×•×¨ ×“×•×—' }}
              </button>
            } @else {
              <button class="generate-report-btn disabled" disabled>
                ×œ× × ×™×ª×Ÿ ×œ×™×¦×•×¨ ×“×•×— - × ×•×›×—×•×ª ×—×¡×¨×”
              </button>
            }

            <!-- Salary Report Details -->
            @if (expandedEmployeeId === salary.id && salary.attendanceComplete) {
              <div class="report-details">
                <div class="report-section-title">×¤×¨×˜×™ ××©×›×•×¨×”</div>
                
                <div class="detail-grid">
                  <div class="detail-item">
                    <label>××©×›×•×¨×ª ×‘×¡×™×¡×™×ª</label>
                    <span>â‚ª{{ formatNumber(salary.baseSalary) }}</span>
                  </div>
                  <div class="detail-item">
                    <label>×‘×•× ×•×¡</label>
                    <span>â‚ª{{ formatNumber(salary.bonus) }}</span>
                  </div>
                  <div class="detail-item">
                    <label>×§×¦×‘×”</label>
                    <span>â‚ª{{ formatNumber(salary.allowance) }}</span>
                  </div>
                  <div class="detail-item">
                    <label>× ×™×›×•×™×™×</label>
                    <span>â‚ª{{ formatNumber(salary.deductions) }}</span>
                  </div>
                </div>

                <div class="total-section">
                  <label>×¡×š ×”×›×œ ×œ×ª×©×œ×•×</label>
                  <span class="total-amount">â‚ª{{ formatNumber(salary.totalSalary) }}</span>
                </div>

                <div class="report-footer">
                  <p class="report-date">×“×•×— ××©×›×•×¨×” - {{ getMonthName(selectedMonth) }} {{ selectedYear }}</p>
                  <button class="print-btn" (click)="printReport(salary)">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 8H5c-1.66 0-3 1.34-3 3v6h4v4h12v-4h4v-6c0-1.66-1.34-3-3-3zm-3 11H8v-5h8v5zm3-7c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-1-9H6v4h12V3z"/>
                    </svg>
                    ×”×“×¤×¡ ×“×•×—
                  </button>
                </div>
              </div>
            }
          </div>
        }
      } @else {
        <div class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5">
            <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
          <p>××™×Ÿ × ×ª×•× ×™ ××©×›×•×¨×” ×œ×ª××¨×™×š ×–×”</p>
        </div>
      }
    </div>
  </section>
</div>