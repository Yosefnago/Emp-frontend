<!-- settings.component.html -->
<div class="settings-container">
  <!-- Header -->
  <div class="settings-header">
    <button class="back-button" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      <span>חזור</span>
    </button>
    <div class="header-content">
      <h1 class="page-title">הגדרות</h1>
      <p class="page-subtitle">ניהול הגדרות אישיות</p>
    </div>
  </div>

  <!-- Settings Tabs -->
  <div class="tabs-section">
    <div class="tabs-header">
      <button 
        class="tab-button"
        [class.active]="activeTab === 'profile'"
        (click)="switchTab('profile')">
        👤 פרופיל אישי
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'security'"
        (click)="switchTab('security')">
        🔒 אבטחה
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'notifications'"
        (click)="switchTab('notifications')">
        🔔 התראות
      </button>
      <button 
        class="tab-button"
        [class.active]="activeTab === 'preferences'"
        (click)="switchTab('preferences')">
        ⚙️ העדפות
      </button>
    </div>
  </div>

  <!-- Profile Tab -->
  @if (activeTab === 'profile') {
    <section class="settings-section">
      <div class="section-header">
        <h2 class="section-title">פרופיל אישי</h2>
        <p class="section-subtitle">עדכן את פרטיך האישיים</p>
      </div>

      <div class="profile-content">
        <!-- Profile Picture -->
        <div class="profile-picture-section">
          <div class="profile-picture">
            {{ getInitials(user.firstName, user.lastName) }}
          </div>
          <div class="picture-actions">
            <button class="upload-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
              </svg>
              שנה תמונה
            </button>
            <button class="delete-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-9l-1 1H5v2h14V4z"/>
              </svg>
              מחק תמונה
            </button>
          </div>
        </div>

        <!-- Profile Form -->
        <form (ngSubmit)="saveProfile()" #profileForm="ngForm" class="settings-form">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">שם פרטי</label>
              <input 
                type="text" 
                [(ngModel)]="user.firstName" 
                name="firstName"
                class="form-input"
                required>
            </div>

            <div class="form-group">
              <label class="form-label">שם משפחה</label>
              <input 
                type="text" 
                [(ngModel)]="user.lastName" 
                name="lastName"
                class="form-input"
                required>
            </div>

            <div class="form-group full-width">
              <label class="form-label">דוא"ל</label>
              <input 
                type="email" 
                [(ngModel)]="user.email" 
                name="email"
                class="form-input"
                required>
            </div>

            <div class="form-group">
              <label class="form-label">מספר טלפון</label>
              <input 
                type="tel" 
                [(ngModel)]="user.phone" 
                name="phone"
                class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">תאריך לידה</label>
              <input 
                type="date" 
                [(ngModel)]="user.birthDate" 
                name="birthDate"
                class="form-input">
            </div>

            <div class="form-group">
              <label class="form-label">מיקום</label>
              <input 
                type="text" 
                [(ngModel)]="user.location" 
                name="location"
                class="form-input"
                placeholder="עיר, מדינה">
            </div>

            <div class="form-group full-width">
              <label class="form-label">אודות</label>
              <textarea 
                [(ngModel)]="user.bio" 
                name="bio"
                class="form-textarea"
                placeholder="ספר קצת על עצמך"
                rows="3"></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button type="submit" class="submit-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
              </svg>
              שמור שינויים
            </button>
          </div>
        </form>
      </div>
    </section>
  }

  <!-- Security Tab -->
  @if (activeTab === 'security') {
    <section class="settings-section">
      <div class="section-header">
        <h2 class="section-title">אבטחה</h2>
        <p class="section-subtitle">נהל את אבטחת החשבון שלך</p>
      </div>

      <div class="security-content">
        <!-- Password Change -->
        <div class="security-card">
          <div class="card-header">
            <h3 class="card-title">🔐 שנה סיסמה</h3>
            <p class="card-subtitle">עדכן את הסיסמה שלך באופן קבוע</p>
          </div>
          <form (ngSubmit)="changePassword()" #passwordForm="ngForm" class="security-form">
            <div class="form-group">
              <label class="form-label">סיסמה נוכחית</label>
              <input 
                type="password" 
                [(ngModel)]="passwordData.current" 
                name="current"
                class="form-input"
                required>
            </div>
            <div class="form-group">
              <label class="form-label">סיסמה חדשה</label>
              <input 
                type="password" 
                [(ngModel)]="passwordData.new" 
                name="new"
                class="form-input"
                required>
            </div>
            <div class="form-group">
              <label class="form-label">אשר סיסמה</label>
              <input 
                type="password" 
                [(ngModel)]="passwordData.confirm" 
                name="confirm"
                class="form-input"
                required>
            </div>
            <button type="submit" class="submit-btn">עדכן סיסמה</button>
          </form>
        </div>

        <!-- Two-Factor Authentication -->
        <div class="security-card">
          <div class="card-header">
            <h3 class="card-title">✓ אימות דו-שלבי</h3>
            <p class="card-subtitle">הגבר את אבטחת החשבון</p>
          </div>
          <div class="card-content">
            <div class="security-status">
              <span class="status-label">מצב:</span>
              <span class="status-badge" [class]="user.twoFactorEnabled ? 'active' : 'inactive'">
                {{ user.twoFactorEnabled ? '✓ מופעל' : '✗ מבוטל' }}
              </span>
            </div>
            <p class="status-description">
              {{ user.twoFactorEnabled ? 
                'אימות דו-שלבי מופעל. משתמשים צריכים קוד נוסף בעת התחברות.' :
                'הפעל אימות דו-שלבי כדי להגביר אבטחה' }}
            </p>
            <button 
              class="security-toggle-btn" 
              [class]="user.twoFactorEnabled ? 'disable' : 'enable'"
              (click)="toggleTwoFactor()">
              {{ user.twoFactorEnabled ? 'בטל אימות דו-שלבי' : 'הפעל אימות דו-שלבי' }}
            </button>
          </div>
        </div>

        <!-- Active Sessions -->
        <div class="security-card">
          <div class="card-header">
            <h3 class="card-title">🔌 הפעלות פעילות</h3>
            <p class="card-subtitle">נהל את המכשירים המחוברים</p>
          </div>
          <div class="sessions-list">
            @for (session of activeSessions; track session.id) {
              <div class="session-item">
                <div class="session-info">
                  <div class="session-device">
                    {{ session.deviceType }} - {{ session.browser }}
                  </div>
                  <div class="session-details">
                    <span>{{ session.location }}</span>
                    <span>{{ session.lastActive | date:'dd/MM/yyyy HH:mm' }}</span>
                  </div>
                </div>
                @if (!session.isCurrent) {
                  <button class="logout-btn" (click)="logoutSession(session.id)">
                    התחבר החוצה
                  </button>
                }
              </div>
            }
          </div>
        </div>
      </div>
    </section>
  }

  <!-- Notifications Tab -->
  @if (activeTab === 'notifications') {
    <section class="settings-section">
      <div class="section-header">
        <h2 class="section-title">התראות</h2>
        <p class="section-subtitle">בחר איזה התראות תרצה לקבל</p>
      </div>

      <div class="notifications-content">
        @for (notification of notificationSettings; track notification.id) {
          <div class="notification-item">
            <div class="notification-info">
              <h4 class="notification-title">{{ notification.title }}</h4>
              <p class="notification-description">{{ notification.description }}</p>
            </div>
            <div class="notification-toggle">
              <input 
                type="checkbox" 
                [(ngModel)]="notification.enabled"
                [id]="'notif-' + notification.id"
                class="toggle-checkbox">
              <label [for]="'notif-' + notification.id" class="toggle-label"></label>
            </div>
          </div>
        }
      </div>

      <div class="notification-channels">
        <h3 class="section-subtitle">ערוצי התראה</h3>
        <div class="channels-grid">
          <div class="channel-item">
            <input 
              type="checkbox" 
              [(ngModel)]="channels.email"
              id="channel-email"
              class="toggle-checkbox">
            <label for="channel-email" class="channel-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
              </svg>
              דוא"ל
            </label>
          </div>
          <div class="channel-item">
            <input 
              type="checkbox" 
              [(ngModel)]="channels.push"
              id="channel-push"
              class="toggle-checkbox">
            <label for="channel-push" class="channel-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V2h-3v2.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
              </svg>
              התראות</label>
          </div>
          <div class="channel-item">
            <input 
              type="checkbox" 
              [(ngModel)]="channels.sms"
              id="channel-sms"
              class="toggle-checkbox">
            <label for="channel-sms" class="channel-label">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
              </svg>
              הודעות</label>
          </div>
        </div>
      </div>

      <div class="form-actions">
        <button class="submit-btn" (click)="saveNotifications()">שמור העדפות</button>
      </div>
    </section>
  }

  <!-- Preferences Tab -->
  @if (activeTab === 'preferences') {
    <section class="settings-section">
      <div class="section-header">
        <h2 class="section-title">העדפות</h2>
        <p class="section-subtitle">התאם את חוויית האפליקציה</p>
      </div>

      <form (ngSubmit)="savePreferences()" #preferencesForm="ngForm" class="preferences-form">
        <!-- Language -->
        <div class="preference-group">
          <h3 class="preference-title">🌐 שפה</h3>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.language" 
                name="language"
                value="he"
                class="radio-input">
              <span>עברית</span>
            </label>
          </div>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.language" 
                name="language"
                value="en"
                class="radio-input">
              <span>English</span>
            </label>
          </div>
        </div>

        <!-- Theme -->
        <div class="preference-group">
          <h3 class="preference-title">🎨 עיצוב</h3>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.theme" 
                name="theme"
                value="light"
                class="radio-input">
              <span>בהיר</span>
            </label>
          </div>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.theme" 
                name="theme"
                value="dark"
                class="radio-input">
              <span>אפל</span>
            </label>
          </div>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.theme" 
                name="theme"
                value="auto"
                class="radio-input">
              <span>אוטומטי</span>
            </label>
          </div>
        </div>

        <!-- Time Format -->
        <div class="preference-group">
          <h3 class="preference-title">⏰ פורמט שעה</h3>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.timeFormat" 
                name="timeFormat"
                value="24h"
                class="radio-input">
              <span>24 שעות</span>
            </label>
          </div>
          <div class="preference-option">
            <label class="option-label">
              <input 
                type="radio" 
                [(ngModel)]="preferences.timeFormat" 
                name="timeFormat"
                value="12h"
                class="radio-input">
              <span>12 שעות</span>
            </label>
          </div>
        </div>

        <!-- Data Privacy -->
        <div class="preference-group">
          <h3 class="preference-title">🔐 פרטיות נתונים</h3>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>אפשר ניתוח נתונים</h4>
              <p>עזור לנו לשפר את האפליקציה דרך נתוני שימוש</p>
            </div>
            <input 
              type="checkbox" 
              [(ngModel)]="preferences.analyticsEnabled"
              name="analytics"
              class="toggle-checkbox">
          </div>
          <div class="toggle-item">
            <div class="toggle-info">
              <h4>שלח דוחות טעויות אוטומטי</h4>
              <p>עזור לנו לתקן בעיות על ידי שליחת דוחות קריסה</p>
            </div>
            <input 
              type="checkbox" 
              [(ngModel)]="preferences.crashReports"
              name="crashReports"
              class="toggle-checkbox">
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="submit-btn">שמור העדפות</button>
        </div>
      </form>
    </section>
  }

  <!-- Danger Zone -->
  <section class="danger-zone">
    <h3 class="danger-title">⚠️ אזור סכנה</h3>
    <div class="danger-actions">
      <button class="danger-btn delete-account-btn" (click)="requestAccountDeletion()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-9l-1 1H5v2h14V4z"/>
        </svg>
        מחק חשבון
      </button>
      <button class="danger-btn logout-all-btn" (click)="logoutFromAllDevices()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
        </svg>
        התחבר החוצה מכל המכשירים
      </button>
    </div>
  </section>
</div>