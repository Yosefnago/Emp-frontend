
<!-- Top Header Bar -->
<header class="top-header">
  <div class="header-left">
    <h1 class="page-title">דף הבית</h1>
    <p class="page-subtitle">סקירה כללית של המערכת</p>
  </div>
  <div class="header-right">
    <button class="header-btn notification-btn" (click)="openNotifications()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
      </svg>
      @if (notificationCount > 0) {
        <span class="notification-badge">{{ notificationCount }}</span>
      }
    </button>
  </div>
</header>

<!-- Stats Cards -->
<section class="stats-grid">
  <div class="stat-card stat-card-blue"  (click)="navigateTo('employees')">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <span class="stat-trend positive">+5%</span>
    </div>
    <div class="stat-value">{{numberOfEmployees}}</div>
    <div class="stat-label">סה"כ עובדים</div>
  </div>

  <div class="stat-card stat-card-green">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
          <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
          <polyline points="17 6 23 6 23 12"></polyline>
        </svg>
      </div>
      <span class="stat-trend positive">+8%</span>
    </div>
    <div class="stat-value">{{numberOfAttendants}}</div>
    <div class="stat-label">נוכחים</div>
  </div>

  <div class="stat-card stat-card-purple">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <span class="stat-trend">חודשי</span>
    </div>
    <div class="stat-value">₪{{formatNumber(monthlySalaryTotal) }}</div>
    <div class="stat-label">משכורת חודשית</div>
  </div>

  <div class="stat-card stat-card-orange">
    <div class="stat-header">
      <div class="stat-icon-wrapper">
        <svg width="28" height="28" viewBox="0 0 24 24" fill="white">
          <rect x="3" y="3" width="18" height="18" rx="2"></rect>
          <path d="M3 9h18"></path>
          <path d="M9 21V9"></path>
        </svg>
      </div>
      <span class="stat-trend positive">+2</span>
    </div>
    <div class="stat-value">{{projectsOnboard}}</div>
    <div class="stat-label">פרויקטים פעילים</div>
  </div>
</section>

<!-- Quick Actions -->
<section class="quick-actions">
  <h2 class="section-title">פעולות מהירות</h2>
  <div class="actions-grid">
    <button class="action-card" (click)="navigateTo('employees')">
      <div class="action-icon action-icon-blue">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <h3 class="action-title">ניהול עובדים</h3>
      <p class="action-description">צפייה בפרטי העובדים וניהול מידע אישי</p>
      <span class="action-arrow">←</span>
    </button>

    <button class="action-card" (click)="navigateTo('salary')">
      <div class="action-icon action-icon-teal">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
          <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
        </svg>
      </div>
      <h3 class="action-title">מערכת שכר</h3>
      <p class="action-description">ניהול משכורות וקבלות שכר</p>
      <span class="action-arrow coming-soon">בקרוב</span>
    </button>

    <button class="action-card" (click)="navigateTo('attendance')">
      <div class="action-icon action-icon-purple">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
      </div>
      <h3 class="action-title">דוחות נוכחות</h3>
      <p class="action-description">צפייה בדוחות נוכחות ויומני עבודה</p>
      <span class="action-arrow coming-soon">בקרוב</span>
    </button>
  </div>
</section>

<!-- Recent Activity Section -->
<section class="recent-activity">
  <div class="section-header">
    <h2 class="section-title">פעילות אחרונה</h2>
    <a (click)="navigateTo('logs')" class="view-all-link">צפה בהכל</a>
  </div>

  
  <!-- Activities List -->
  @if (lastActivities.length > 0) {
    <div class="activity-list">
      @for (item of lastActivities; track $index) {
        <div class="activity-item">
          
          <!-- Dynamic Icon Based on Action Type -->
          <!-- ADD icon - Green background with plus symbol -->
          @if (getActivityIconType(item.action) === 'add') {
            <div class="activity-icon activity-icon-add" aria-label="הוספה">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </div>
          }
          <!-- EDIT icon - Blue background with pencil symbol -->
          @else if (getActivityIconType(item.action) === 'edit') {
            <div class="activity-icon activity-icon-edit" aria-label="עדכון">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
              </svg>
            </div>
          }
          <!-- DELETE icon - Red background with trash symbol -->
          @else if (getActivityIconType(item.action) === 'delete') {
            <div class="activity-icon activity-icon-delete" aria-label="מחיקה">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
              </svg>
            </div>
          }
          <!-- APPROVE icon - Sky blue background with checkmark symbol -->
          @else if (getActivityIconType(item.action) === 'approve') {
            <div class="activity-icon activity-icon-approve" aria-label="אישור">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="20 6 9 17 4 12"></polyline>
              </svg>
            </div>
          }
          <!-- DEFAULT icon - Gray background with info symbol -->
          @else {
            <div class="activity-icon activity-icon-default" aria-label="פעילות">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
              </svg>
            </div>
          }

          <!-- Activity Content with Parsed Message -->
          <div class="activity-content">
            <p class="activity-text"><strong>
              {{ getActivityMessage(item).label }}</strong>
              @if (getActivityMessage(item).details) {
                <span class="activity-details">: {{ getActivityMessage(item).details }}</span>
              }
            </p>
            <span class="activity-time">
              {{ formatRelativeTime(item.dateAction, item.timeAction) }}
            </span>
          </div>
        </div>
      }
    </div>
  }

  <!-- Empty State -->
  @else {
    <div class="activity-empty">
      <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="16" x2="12" y2="12"></line>
        <line x1="12" y1="8" x2="12.01" y2="8"></line>
      </svg>
      <p>אין פעילות אחרונה להצגה</p>
    </div>
  }
</section>

<!-- Notifications Modal -->
<app-notifications-modal
  (close)="onNotificationsClose()">
</app-notifications-modal>