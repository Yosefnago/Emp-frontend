<!-- attendance.component.html -->
<div class="attendance-container">
  <!-- Header with Filters -->
  <div class="attendance-header">
    <button class="back-button" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="19" y1="12" x2="5" y2="12"></line>
        <polyline points="12 19 5 12 12 5"></polyline>
      </svg>
      <span>专</span>
    </button>
    <div class="header-content">
      <h1 class="page-title">专砖转 转</h1>
      <p class="page-subtitle"> 转 注</p>
    </div>
  </div>

  <!-- Filters Section -->
  <section class="filters-section">
    <div class="filter-group">
      <div class="filter-item">
        <label class="filter-label">砖</label>
        <select [(ngModel)]="selectedYear" (change)="filterAttendance()" class="filter-select">
          <option value=""> 砖</option>
          @for (year of availableYears; track year) {
          <option [value]="year">{{ year }}</option>
          }
        </select>
      </div>

      <div class="filter-item">
        <label class="filter-label">砖</label>
        <select [(ngModel)]="selectedMonth" (change)="filterAttendance()" class="filter-select">
          <option value=""> 砖</option>
          <option value="1">专</option>
          <option value="2">驻专专</option>
          <option value="3">专抓</option>
          <option value="4">驻专</option>
          <option value="5"></option>
          <option value="6"></option>
          <option value="7"></option>
          <option value="8">住</option>
          <option value="9">住驻专</option>
          <option value="10">拽专</option>
          <option value="11">专</option>
          <option value="12">爪专</option>
        </select>
      </div>

      <div class="filter-item">
        <label class="filter-label">拽</label>
        <select [(ngModel)]="selectedDepartment" (change)="filterAttendance()" class="filter-select">
          <option value=""> 拽转</option>
          @for (dept of departments; track dept) {
          <option [value]="dept">{{ dept }}</option>
          }
        </select>
      </div>

      <div class="filter-item">
        <label class="filter-label">注</label>
        <select [(ngModel)]="selectedEmployeeName" (change)="filterAttendance()" class="filter-select">
          <option value=""> 注</option>
          @for (emp of availableEmployees; track emp.name) {
          <option [value]="emp.name">{{ emp.name }}</option>
          }
        </select>
      </div>

      <button class="filter-reset-btn" (click)="clearFilters()">拽 住</button>
    </div>
  </section>

  <!-- Attendance Table -->
  <section class="records-section">
    <div class="table-container">
      @if (filteredRecords.length > 0) {
      <table class="attendance-table">
        <thead>
          <tr>
            <th>转专</th>
            <th>砖 注</th>
            <th>转驻拽</th>
            <th>拽</th>
            <th>住</th>
            <th>爪</th>
            <th>砖注转</th>
            <th>住</th>
            <th>住注转</th>
          </tr>
        </thead>
        <tbody>
          @for (record of filteredRecords; track record.id) {
          <tr class="record-row" [class.expanded-row]="expandedId === record.id">
            <td (click)="toggleRecord(record.id)">
              <div class="date-cell">
                <span class="date-text">{{ record.date | date:'dd/MM/yyyy' }}</span>
                <span class="day-text">{{ getDayOfWeek(record.date) }}</span>
              </div>
            </td>
            <td class="font-medium">
              {{ record.employeeName }}
            </td>
            <td>{{ record.employeePosition }}</td>
            <td>
              <span class="dept-badge">{{ record.department || '-' }}</span>
            </td>
            <td>{{ record.checkInTime || '-' }}</td>
            <td>{{ record.checkOutTime || '-' }}</td>
            <td>{{ calculateWorkHours(record.checkInTime, record.checkOutTime) }}</td>
            <td>
              <span class="stat-badge" [class]="'badge-' + record.status?.toLowerCase()">
                {{ translateStatus(record.status) }}
              </span>
            </td>
            <td>
              {{ record.travelAllowance ? '' : '' }}
            </td>
          </tr>
          }
        </tbody>
      </table>
      } @else {
      <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.5">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
          <line x1="16" y1="2" x2="16" y2="6" />
          <line x1="8" y1="2" x2="8" y2="6" />
          <line x1="3" y1="10" x2="21" y2="10" />
        </svg>
        <p> 爪 专砖转 转转 转 住</p>
      </div>
      }
    </div>
  </section>

  <!-- Statistics Summary -->
  <section class="summary-section">
    <h3 class="section-title"> 住 转</h3>
    <div class="summary-grid">
      <div class="summary-card summary-present">
        <p class="summary-label"> </p>
        <p class="summary-value">{{ getSummary()?.presentDays }}</p>
      </div>
      <div class="summary-card summary-absent">
        <p class="summary-label"> 住专</p>
        <p class="summary-value">{{ getSummary()?.absentDays }}</p>
      </div>
      <div class="summary-card summary-sick">
        <p class="summary-label"> </p>
        <p class="summary-value">{{ getSummary()?.sickDays }}</p>
      </div>
      <div class="summary-card summary-vacation">
        <p class="summary-label"> 驻砖</p>
        <p class="summary-value">{{ getSummary()?.vacationDays }}</p>
      </div>
      <div class="summary-card summary-rate">
        <p class="summary-label">砖注专 转</p>
        <p class="summary-value">{{ getSummary()?.attendanceRate }}%</p>
      </div>
    </div>
  </section>
</div>